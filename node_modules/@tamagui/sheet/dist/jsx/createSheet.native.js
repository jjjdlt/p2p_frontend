import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useComposedRefs } from "@tamagui/compose-refs";
import { useIsomorphicLayoutEffect } from "@tamagui/constants";
import { Stack } from "@tamagui/core";
import { composeEventHandlers, withStaticProperties } from "@tamagui/helpers";
import { RemoveScroll } from "@tamagui/remove-scroll";
import { useDidFinishSSR } from "@tamagui/use-did-finish-ssr";
import { forwardRef, memo, useMemo } from "react";
import { Platform } from "react-native";
import { SHEET_HANDLE_NAME, SHEET_NAME, SHEET_OVERLAY_NAME } from "./constants";
import { getNativeSheet } from "./nativeSheet";
import { useSheetContext } from "./SheetContext";
import { SheetImplementationCustom } from "./SheetImplementationCustom";
import { SheetScrollView } from "./SheetScrollView";
import { useSheetController } from "./useSheetController";
import { useSheetOffscreenSize } from "./useSheetOffscreenSize";
function _define_property(obj, key, value) {
  return key in obj ? Object.defineProperty(obj, key, {
    value,
    enumerable: !0,
    configurable: !0,
    writable: !0
  }) : obj[key] = value, obj;
}
function _object_spread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {}, ownKeys2 = Object.keys(source);
    typeof Object.getOwnPropertySymbols == "function" && (ownKeys2 = ownKeys2.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {
      return Object.getOwnPropertyDescriptor(source, sym).enumerable;
    }))), ownKeys2.forEach(function(key) {
      _define_property(target, key, source[key]);
    });
  }
  return target;
}
function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);
  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    enumerableOnly && (symbols = symbols.filter(function(sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    })), keys.push.apply(keys, symbols);
  }
  return keys;
}
function _object_spread_props(target, source) {
  return source = source ?? {}, Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function(key) {
    Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
  }), target;
}
function _object_without_properties(source, excluded) {
  if (source == null) return {};
  var target = _object_without_properties_loose(source, excluded), key, i;
  if (Object.getOwnPropertySymbols) {
    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);
    for (i = 0; i < sourceSymbolKeys.length; i++)
      key = sourceSymbolKeys[i], !(excluded.indexOf(key) >= 0) && Object.prototype.propertyIsEnumerable.call(source, key) && (target[key] = source[key]);
  }
  return target;
}
function _object_without_properties_loose(source, excluded) {
  if (source == null) return {};
  var target = {}, sourceKeys = Object.keys(source), key, i;
  for (i = 0; i < sourceKeys.length; i++)
    key = sourceKeys[i], !(excluded.indexOf(key) >= 0) && (target[key] = source[key]);
  return target;
}
function createSheet(param) {
  var Handle = param.Handle, Frame = param.Frame, Overlay = param.Overlay, SheetHandle = Handle.styleable(function(_param, forwardedRef) {
    var __scopeSheet = _param.__scopeSheet, props = _object_without_properties(_param, [
      "__scopeSheet"
    ]), context = useSheetContext(SHEET_HANDLE_NAME, __scopeSheet), composedRef = useComposedRefs(context.handleRef, forwardedRef);
    return context.onlyShowFrame ? null : (
      // @ts-ignore
      /* @__PURE__ */ _jsx(Handle, _object_spread({
        ref: composedRef,
        onPress: function() {
          var max = context.snapPoints.length + (context.dismissOnSnapToBottom ? -1 : 0), nextPos = (context.position + 1) % max;
          context.setPosition(nextPos);
        },
        open: context.open
      }, props))
    );
  }), SheetOverlay = Overlay.extractable(/* @__PURE__ */ memo(function(propsIn) {
    var __scopeSheet = propsIn.__scopeSheet, props = _object_without_properties(propsIn, [
      "__scopeSheet"
    ]), context = useSheetContext(SHEET_OVERLAY_NAME, __scopeSheet), element = useMemo(function() {
      return (
        // @ts-ignore
        /* @__PURE__ */ _jsx(Overlay, _object_spread_props(_object_spread({}, props), {
          onPress: composeEventHandlers(props.onPress, context.dismissOnOverlayPress ? function() {
            context.setOpen(!1);
          } : void 0)
        }))
      );
    }, [
      props.onPress,
      context.dismissOnOverlayPress
    ]);
    return useIsomorphicLayoutEffect(function() {
      var _context_onOverlayComponent;
      (_context_onOverlayComponent = context.onOverlayComponent) === null || _context_onOverlayComponent === void 0 || _context_onOverlayComponent.call(context, element);
    }, [
      element
    ]), context.onlyShowFrame, null;
  })), SheetFrame = Frame.extractable(/* @__PURE__ */ forwardRef(function(_param, forwardedRef) {
    var __scopeSheet = _param.__scopeSheet, adjustPaddingForOffscreenContent = _param.adjustPaddingForOffscreenContent, disableHideBottomOverflow = _param.disableHideBottomOverflow, children = _param.children, props = _object_without_properties(_param, [
      "__scopeSheet",
      "adjustPaddingForOffscreenContent",
      "disableHideBottomOverflow",
      "children"
    ]), context = useSheetContext(SHEET_NAME, __scopeSheet), hasFit = context.hasFit, removeScrollEnabled = context.removeScrollEnabled, frameSize = context.frameSize, contentRef = context.contentRef, open = context.open, composedContentRef = useComposedRefs(forwardedRef, contentRef), offscreenSize = useSheetOffscreenSize(context), sheetContents = useMemo(function() {
      return (
        // @ts-ignore
        /* @__PURE__ */ _jsxs(Frame, _object_spread_props(_object_spread({
          ref: composedContentRef,
          flex: hasFit ? 0 : 1,
          height: hasFit ? void 0 : frameSize,
          pointerEvents: open ? "auto" : "none"
        }, props), {
          children: [
            children,
            adjustPaddingForOffscreenContent && /* @__PURE__ */ _jsx(Stack, {
              "data-sheet-offscreen-pad": !0,
              height: offscreenSize,
              width: "100%"
            })
          ]
        }))
      );
    }, [
      open,
      props,
      frameSize,
      offscreenSize,
      adjustPaddingForOffscreenContent,
      hasFit
    ]);
    return /* @__PURE__ */ _jsxs(_Fragment, {
      children: [
        /* @__PURE__ */ _jsx(RemoveScroll, {
          forwardProps: !0,
          enabled: removeScrollEnabled,
          allowPinchZoom: !0,
          shards: [
            contentRef
          ],
          // causes lots of bugs on touch web on site
          removeScrollBar: !1,
          children: sheetContents
        }),
        /* below frame hide when bouncing past 100% */
        !disableHideBottomOverflow && // @ts-ignore
        /* @__PURE__ */ _jsx(Frame, _object_spread_props(_object_spread({}, props), {
          componentName: "SheetCover",
          // biome-ignore lint/correctness/noChildrenProp: <explanation>
          children: null,
          position: "absolute",
          bottom: "-100%",
          zIndex: -1,
          height: context.frameSize,
          left: 0,
          right: 0,
          borderWidth: 0,
          borderRadius: 0,
          shadowOpacity: 0
        }))
      ]
    });
  })), Sheet = /* @__PURE__ */ forwardRef(function(props, ref) {
    var hydrated = useDidFinishSSR(), isShowingNonSheet = useSheetController().isShowingNonSheet, SheetImplementation = SheetImplementationCustom;
    if (props.native && Platform.OS === "ios") {
      var impl = getNativeSheet("ios");
      impl && (SheetImplementation = impl);
    }
    return isShowingNonSheet || !hydrated ? null : /* @__PURE__ */ _jsx(SheetImplementation, _object_spread({
      ref
    }, props));
  }), components = {
    Frame: SheetFrame,
    Overlay: SheetOverlay,
    Handle: SheetHandle,
    ScrollView: SheetScrollView
  }, Controlled = withStaticProperties(Sheet, components);
  return withStaticProperties(Sheet, _object_spread_props(_object_spread({}, components), {
    Controlled
  }));
}
export {
  createSheet
};
//# sourceMappingURL=createSheet.js.map
